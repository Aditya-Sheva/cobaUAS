// Data Produk
const products = [
    {
        id: 1,
        name: "Elegant Silk Dress",
        price: 295.000,
        image: "img/11.JPG",
        category: "Dress",
        rating: 4.5,
        description: "A beautiful silk dress perfect for elegant occasions."
    },
    {
        id: 2,
        name: "Classic White Blouse",
        price: 295.000,
        image: "img/77.JPG",
        category: "Blouse",
        rating: 4.3,
        description: "Timeless white blouse with delicate details."
    },
    {
        id: 3,
        name: "Floral Summer Dress",
        price: 295.000,
        image: "img/33.JPG",
        category: "Dress",
        rating: 4.7,
        description: "Vibrant floral dress perfect for summer events."
    },
    {
        id: 4,
        name: "Black Cocktail Dress",
        price: 295.000,
        image: "img/44.JPG",
        category: "Dress",
        rating: 4.6,
        description: "Sophisticated black dress for evening wear."
    },
    {
        id: 5,
        name: "Casual Denim Jacket",
        price: 295.000,
        image: "img/55.JPG",
        category: "Jacket",
        rating: 4.4,
        description: "Comfortable and stylish denim jacket."
    },
    {
        id: 6,
        name: "Silk Palazzo Pants",
        price: 295.000,
        image: "img/66.JPG",
        category: "Pants",
        rating: 4.5,
        description: "Luxurious silk palazzo pants for a chic look."
    },
    {
        id: 7,
        name: "Silk Palazzo Pants",
        price: 295.000,
        image: "img/1010.JPG",
        category: "Pants",
        rating: 4.5,
        description: "Luxurious silk palazzo pants for a chic look."
    },
    {
        id: 8,
        name: "Silk Palazzo Pants",
        price: 295.000,
        image: "img/88.JPG",
        category: "Pants",
        rating: 4.5,
        description: "Luxurious silk palazzo pants for a chic look."
    },
    {
        id: 9,
        name: "Silk Palazzo Pants",
        price: 295.000,
        image: "img/99.JPG",
        category: "Pants",
        rating: 4.5,
        description: "Luxurious silk palazzo pants for a chic look."
    },
    {
        id: 10,
        name: "Silk Palazzo Pants",
        price: 295.000,
        image: "img/99.JPG",
        category: "Pants",
        rating: 4.5,
        description: "Luxurious silk palazzo pants for a chic look."
    },
    {
        id: 11,
        name: "Silk Palazzo Pants",
        price: 295.000,
        image: "img/99.JPG",
        category: "Pants",
        rating: 4.5,
        description: "Luxurious silk palazzo pants for a chic look."
    },
    {
        id: 12,
        name: "Silk Palazzo Pants",
        price: 295.000,
        image: "img/99.JPG",
        category: "Pants",
        rating: 4.5,
        description: "Luxurious silk palazzo pants for a chic look."
    },
    {
        id: 13,
        name: "Silk Palazzo Pants",
        price: 295.000,
        image: "img/99.JPG",
        category: "Pants",
        rating: 4.5,
        description: "Luxurious silk palazzo pants for a chic look."
    },
    {
        id: 14,
        name: "Silk Palazzo Pants",
        price: 295.000,
        image: "img/99.JPG",
        category: "Pants",
        rating: 4.5,
        description: "Luxurious silk palazzo pants for a chic look."
    },
    {
        id: 15,
        name: "Silk Palazzo Pants",
        price: 295.000,
        image: "img/99.JPG",
        category: "Pants",
        rating: 4.5,
        description: "Luxurious silk palazzo pants for a chic look."
    },
    {
        id: 16,
        name: "Silk Palazzo Pants",
        price: 295.000,
        image: "img/99.JPG",
        category: "Pants",
        rating: 4.5,
        description: "Luxurious silk palazzo pants for a chic look."
    },
    {
        id: 17,
        name: "Silk Palazzo Pants",
        price: 295.000,
        image: "img/99.JPG",
        category: "Pants",
        rating: 4.5,
        description: "Luxurious silk palazzo pants for a chic look."
    },
    {
        id: 18,
        name: "Silk Palazzo Pants",
        price: 295.000,
        image: "img/99.JPG",
        category: "Pants",
        rating: 4.5,
        description: "Luxurious silk palazzo pants for a chic look."
    },
    {
        id: 19,
        name: "Silk Palazzo Pants",
        price: 295.000,
        image: "img/99.JPG",
        category: "Pants",
        rating: 4.5,
        description: "Luxurious silk palazzo pants for a chic look."
    },
    {
        id: 20,
        name: "Silk Palazzo Pants",
        price: 295.000,
        image: "img/99.JPG",
        category: "Pants",
        rating: 4.5,
        description: "Luxurious silk palazzo pants for a chic look."
    },
    {
        id: 21,
        name: "Silk Palazzo Pants",
        price: 295.000,
        image: "img/99.JPG",
        category: "Pants",
        rating: 4.5,
        description: "Luxurious silk palazzo pants for a chic look."
    },
    {
        id: 22,
        name: "Silk Palazzo Pants",
        price: 295.000,
        image: "img/99.JPG",
        category: "Pants",
        rating: 4.5,
        description: "Luxurious silk palazzo pants for a chic look."
    },
    {
        id: 23,
        name: "Silk Palazzo Pants",
        price: 295.000,
        image: "img/99.JPG",
        category: "Pants",
        rating: 4.5,
        description: "Luxurious silk palazzo pants for a chic look."
    },
    {
        id: 24,
        name: "Silk Palazzo Pants",
        price: 295.000,
        image: "img/99.JPG",
        category: "Pants",
        rating: 4.5,
        description: "Luxurious silk palazzo pants for a chic look."
    },
    {
        id: 25,
        name: "Silk Palazzo Pants",
        price: 295.000,
        image: "img/99.JPG",
        category: "Pants",
        rating: 4.5,
        description: "Luxurious silk palazzo pants for a chic look."
    },
    {
        id: 26,
        name: "Silk Palazzo Pants",
        price: 295.000,
        image: "img/99.JPG",
        category: "Pants",
        rating: 4.5,
        description: "Luxurious silk palazzo pants for a chic look."
    }
];

// Utility untuk localStorage
const LocalStorageUtil = {
    get: (key, defaultValue = []) => {
        try {
            const item = localStorage.getItem(key);
            return item ? JSON.parse(item) : defaultValue;
        } catch (error) {
            console.error(`Error retrieving ${key} from localStorage:`, error);
            return defaultValue;
        }
    },
    set: (key, value) => {
        try {
            localStorage.setItem(key, JSON.stringify(value));
        } catch (error) {
            console.error(`Error saving ${key} to localStorage:`, error);
        }
    },
    remove: (key) => {
        try {
            localStorage.removeItem(key);
        } catch (error) {
            console.error(`Error removing ${key} from localStorage:`, error);
        }
    }
};

// Fungsi untuk menambahkan ke keranjang
function addToCart(product) {
    const cartItems = LocalStorageUtil.get('cartItems');
    const existingItemIndex = cartItems.findIndex(item => item.id === product.id);

    if (existingItemIndex > -1) {
        cartItems[existingItemIndex].quantity += 1;
    } else {
        cartItems.push({ ...product, quantity: 1 });
    }

    LocalStorageUtil.set('cartItems', cartItems);
    updateCartCount();
    
    // Optional: Notifikasi
    alert(`${product.name} added to cart!`);

    displayCart();
}

// Fungsi untuk menambahkan ke wishlist
function addToWishlist(productId) {
    const wishlistItems = LocalStorageUtil.get('wishlistItems');
    
    if (!wishlistItems.includes(productId)) {
        wishlistItems.push(productId);
        LocalStorageUtil.set('wishlistItems', wishlistItems);
        updateWishlistCount();
        
        // Optional: Tampilkan notifikasi
        alert('Product added to wishlist!');
    } else {
        alert('Product already in wishlist!');
    }
}

// Fungsi untuk update cart count
function updateCartCount() {
    const cartItems = LocalStorageUtil.get('cartItems');
    const cartCountEl = document.getElementById('cart-count');

    const totalItems = cartItems.reduce((sum, item) => sum + item.quantity, 0);

    if (cartCountEl) {
        cartCountEl.textContent = totalItems;
    }
}

// Fungsi untuk update wishlist count
function updateWishlistCount() {
    const wishlistItems = LocalStorageUtil.get('wishlistItems');
    const wishlistCountEl = document.getElementById('wishlist-count');
    
    if (wishlistCountEl) {
        wishlistCountEl.textContent = wishlistItems.length;
    }
}

// Fungsi untuk membuat kartu produk
function createProductCard(product) {
    const card = document.createElement('div');
    card.classList.add('product-card');
    card.innerHTML = `
        <a href="detail-product.html?productId=${product.id}" class="product-detail-link">
            <img src="${product.image}" alt="${product.name}" class="product-image">
        </a>
        <div class="product-details">
            <h3 class="product-name">${product.name}</h3>
            <div class="product-info">
                <span class="product-price">Rp${product.price.toFixed(3)}</span>
                <div class="product-rating">
                    <i class="fas fa-star"></i>
                    <span>${product.rating}</span>
                </div>
            </div>
            <div class="product-actions">
                <button class="btn btn-primary add-to-cart" data-id="${product.id}">
                    Add to Cart
                </button>
                <button class="btn btn-wishlist add-to-wishlist" data-id="${product.id}">
                    <i class="fas fa-heart"></i>
                </button>
            </div>
        </div>
    `;

    // Add event listeners
    card.querySelector('.add-to-cart').addEventListener('click', () => {
        addToCart(product);
    });

    card.querySelector('.add-to-wishlist').addEventListener('click', () => {
        addToWishlist(product.id);
    });

    return card;
}

// Fungsi untuk render produk
function renderProducts() {
    const productGrid = document.getElementById('product-grid');
    
    if (!productGrid) {
        console.error('Element with ID "product-grid" not found.');
        return;
    }

    productGrid.innerHTML = '';

    products.forEach(product => {
        const productCard = createProductCard(product);
        productGrid.appendChild(productCard);
    });
}

// Fungsi untuk menampilkan detail produk
function displayProductDetails() {
    // Get product ID from URL parameter instead of localStorage
    const urlParams = new URLSearchParams(window.location.search);
    const productId = parseInt(urlParams.get('productId'));
    
    const product = products.find(p => p.id === productId);
    
    if (!product) {
        console.error('Product not found');
        return;
    }

    const detailsContainer = document.getElementById('product-details-container');
    
    if (!detailsContainer) {
        console.error('Product details container not found');
        return;
    }

    detailsContainer.innerHTML = `
        <div class="product-details-wrapper">
            <div class="product-image-section">
                <img src="${product.image}" alt="${product.name}" class="product-main-image">
            </div>
            <div class="product-info-section">
                <h1 class="product-name">${product.name}</h1>
                <div class="product-price-rating">
                    <span class="product-price">Rp${product.price.toFixed(3)}</span>
                    <div class="product-rating">
                        <i class="fas fa-star"></i>
                        <span>${product.rating} / 5.0</span>
                    </div>
                </div>
                <div class="product-description">
                    <h3>Product Description</h3>
                    <p>${product.description}</p>
                </div>
                <div class="product-details">
                    <p><strong>Category:</strong> ${product.category}</p>
                </div>
                <div class="product-actions">
                    <button class="btn btn-primary add-to-cart" data-id="${product.id}">
                        Add to Cart
                    </button>
                    <button class="btn btn-secondary add-to-wishlist" data-id="${product.id}">
                        Add to Wishlist
                    </button>
                </div>
            </div>
        </div>
    `;

    // Add event listeners
    const addToCartButton = detailsContainer.querySelector('.add-to-cart');
    const addToWishlistButton = detailsContainer.querySelector('.add-to-wishlist');

    if (addToCartButton) {
        addToCartButton.addEventListener('click', () => {
            addToCart(product);
        });
    }

    if (addToWishlistButton) {
        addToWishlistButton.addEventListener('click', () => {
            addToWishlist(product.id);
        });
    }
}

// Fungsi untuk menampilkan halaman wishlist
function displayWishlistPage() {
    const wishlistContainer = document.getElementById('wishlist-container');
    const wishlistItems = LocalStorageUtil.get('wishlistItems');
    
    if (!wishlistContainer) {
        console.error('Wishlist container not found');
        return;
    }

    wishlistContainer.innerHTML = '';

    if (wishlistItems.length === 0) {
        wishlistContainer.innerHTML = `
            <div class="empty-wishlist">
                <h2>Your Wishlist is Empty</h2>
                <p>Start adding your favorite items!</p>
                <a href="index.html" class="btn btn-primary">Go to Products</a>
            </div>
        `;
    } else {
        wishlistItems.forEach(productId => {
            const product = products.find(p => p.id === productId);
            if (product) {
                const productCard = createProductCard(product);
                wishlistContainer.appendChild(productCard);
            }
        });
    }
}

// Fungsi untuk menampilkan keranjang
function displayCart() {
    const cartItems = LocalStorageUtil.get('cartItems');
    const cartContainer = document.getElementById('cart-container');
    
    if (!cartContainer) {
        console.error('Cart container not found');
        return;
    }
    
    cartContainer.innerHTML = '';
    
    if (cartItems.length === 0) {
        cartContainer.innerHTML = `
            <div class="empty-cart">
                <h2>Your cart is empty</h2>
                <a href="index.html" class="btn btn-primary">Go to Products</a>
            </div>
        `;
        return;
    }
    
    const totalPrice = cartItems.reduce((total, item) => total + (item.price * item.quantity), 0);
    
    // Cart Items Section
    const cartItemsSection = document.createElement('div');
    cartItemsSection.classList.add('cart-items-section');
    
    cartItems.forEach(item => {
        const cartItem = document.createElement('div');
        cartItem.classList.add('cart-item');
        cartItem.innerHTML = `
            <div class="cart-item-details">
                <img src="${item.image}" alt="${item.name}" class="cart-item-image">
                <div class="cart-item-info">
                    <h3>${item.name}</h3>
                    <p>Rp${item.price.toFixed(2)} x ${item.quantity}</p>
                    <p>Total: Rp${(item.price * item.quantity).toFixed(2)}</p>
                </div>
            </div>
            <div class="cart-item-actions">
                <button class="btn btn-secondary decrease-quantity" data-id="${item.id}">-</button>
                <button class="btn btn-secondary increase-quantity" data-id="${item.id}">+</button>
                <button class="btn btn-danger remove-item" data-id="${item.id}">Remove</button>
            </div>
        `;
        cartItemsSection.appendChild(cartItem);
    });
    
    // Shipping and Checkout Information Section
    const checkoutSection = document.createElement('div');
    checkoutSection.classList.add('checkout-section');
    checkoutSection.innerHTML = `
        <h2>Shipping Information</h2>
        <form id="checkout-form">
            <div class="form-group">
                <label for="full-name">Full Name</label>
                <input type="text" id="full-name" name="full-name" required>
            </div>
            
            <div class="form-group">
                <label for="phone">Phone Number</label>
                <input type="tel" id="phone" name="phone" required>
            </div>
            
            <div class="form-group">
                <label for="address">Shipping Address</label>
                <textarea id="address" name="address" required></textarea>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="city">City</label>
                    <input type="text" id="city" name="city" required>
                </div>
                
                <div class="form-group">
                    <label for="postal-code">Postal Code</label>
                    <input type="text" id="postal-code" name="postal-code" required>
                </div>
            </div>
            
            <div class="form-group">
                <label for="shipping-method">Shipping Method</label>
                <select id="shipping-method" name="shipping-method">
                    <option value="standard">Standard Shipping (3-5 days) - Free</option>
                    <option value="express">Express Shipping (1-2 days) - Rp20,000</option>
                </select>
            </div>
        </form>
    `;  
    
    // Total and Checkout Button Section
    const totalContainer = document.createElement('div');
    totalContainer.classList.add('cart-total');
    totalContainer.innerHTML = `
        <h3>Total Price: Rp${totalPrice.toFixed(2)}</h3>
        <button id="proceed-checkout" class="btn btn-primary checkout">Proceed to Checkout</button>
    `;
    
    // Combine all sections
    cartContainer.appendChild(cartItemsSection);
    cartContainer.appendChild(checkoutSection);
    cartContainer.appendChild(totalContainer);
    
    // Add event listeners for cart actions
    addCartActionListeners();
    
    // Add event listener for proceed to checkout
    document.getElementById('proceed-checkout').addEventListener('click', validateCheckoutForm);
}

// Function to validate checkout form
function validateCheckoutForm() {
    const form = document.getElementById('checkout-form');
    const inputs = form.querySelectorAll('input, textarea');
    
    let isValid = true;
    
    inputs.forEach(input => {
        if (!input.value.trim()) {
            isValid = false;
            input.classList.add('error');
        } else {
            input.classList.remove('error');
        }
    });
    
    if (isValid) {
        // Collect form data
        const formData = {
            fullName: document.getElementById('full-name').value,
            phone: document.getElementById('phone').value,
            address: document.getElementById('address').value,
            city: document.getElementById('city').value,
            postalCode: document.getElementById('postal-code').value,
            shippingMethod: document.getElementById('shipping-method').value
        };
        
        // Store form data in localStorage or prepare for submission
        localStorage.setItem('checkoutInfo', JSON.stringify(formData));
        
        // Redirect to payment or confirmation page
        window.location.href = 'konfirmasi.html';
    } else {
        alert('Please fill in all required fields');
    }
}
// Fungsi untuk menambahkan event listener ke aksi keranjang
function addCartActionListeners() {
    document.querySelectorAll('.remove-item').forEach(button => {
        button.addEventListener('click', (event) => {
            const productId = parseInt(event.currentTarget.dataset.id);
            let cartItems = LocalStorageUtil.get('cartItems');
            
            cartItems = cartItems.filter(item => item.id !== productId);
            LocalStorageUtil.set('cartItems', cartItems);
            
            displayCart();
            updateCartCount();
        });
    });

    document.querySelectorAll('.increase-quantity').forEach(button => {
        button.addEventListener('click', (event) => {
            const productId = parseInt(event.currentTarget.dataset.id);
            let cartItems = LocalStorageUtil.get('cartItems');

            const item = cartItems.find(item => item.id === productId);
            if (item) item.quantity += 1;

            LocalStorageUtil.set('cartItems', cartItems);
            
            displayCart();
            updateCartCount();
        });
    });

    document.querySelectorAll('.decrease-quantity').forEach(button => {
        button.addEventListener('click', (event) => {
            const productId = parseInt(event.currentTarget.dataset.id);
            let cartItems = LocalStorageUtil.get('cartItems');

            const item = cartItems.find(item => item.id === productId);
            if (item && item.quantity > 1) {
                item.quantity -= 1;
            } else {
                cartItems = cartItems.filter(item => item.id !== productId);
            }

            LocalStorageUtil.set('cartItems', cartItems);
            
            displayCart();
            updateCartCount();
        });
    });
}

// Event Listener for Page Load
document.addEventListener('DOMContentLoaded', () => {
    const currentPath = window.location.pathname;

    if (currentPath.includes('detail-product.html')) {
        displayProductDetails();
    } else if (currentPath.includes('checkout.html')) {
        displayCart();
        updateCartCount();
    } else if (currentPath.includes('wishlist.html')) {
        displayWishlistPage();
        updateWishlistCount();
    } else if (currentPath.includes('index.html') || currentPath === '/'|| currentPath.includes('products.html')) {
        renderProducts();
    }
});